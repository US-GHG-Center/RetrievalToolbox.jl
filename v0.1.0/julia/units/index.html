<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Units Â· RetrievalToolbox.jl</title><meta name="title" content="Units Â· RetrievalToolbox.jl"/><meta property="og:title" content="Units Â· RetrievalToolbox.jl"/><meta property="twitter:title" content="Units Â· RetrievalToolbox.jl"/><meta name="description" content="Documentation for RetrievalToolbox.jl."/><meta property="og:description" content="Documentation for RetrievalToolbox.jl."/><meta property="twitter:description" content="Documentation for RetrievalToolbox.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">RetrievalToolbox.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Main</a></li><li><a class="tocitem" href="../../design/design/">Design</a></li><li><span class="tocitem">Concepts</span><ul><li><a class="tocitem" href="../../concepts/fundamentals/">Fundamentals</a></li><li><a class="tocitem" href="../../concepts/core_concepts/">Core Concepts</a></li><li><a class="tocitem" href="../../concepts/radiance/">Radiance</a></li><li><a class="tocitem" href="../../concepts/phasefunction/">Scattering Phasefunction</a></li></ul></li><li><span class="tocitem">Functions</span><ul><li><a class="tocitem" href="../../functions/state_vector_functions/">State Vector Functions</a></li><li><a class="tocitem" href="../../functions/atmosphere_functions/">Atmosphere Functions</a></li><li><a class="tocitem" href="../../functions/instrument_functions/">Instrument Functions</a></li></ul></li><li><span class="tocitem">Types</span><ul><li><a class="tocitem" href="../../types/atmosphere_types/">Atmosphere Types</a></li><li><a class="tocitem" href="../../types/buffer_types/">Buffer Types</a></li><li><a class="tocitem" href="../../types/RT_types/">Radiative Transfer Method Types</a></li><li><a class="tocitem" href="../../types/state_vector_types/">State Vector Types</a></li><li><a class="tocitem" href="../../types/surface_types/">Surface Types</a></li></ul></li><li><span class="tocitem">Working with Julia</span><ul><li><a class="tocitem" href="../develop/">Develop</a></li><li><a class="tocitem" href="../dicts/">Dictionaries</a></li><li class="is-active"><a class="tocitem" href>Units</a><ul class="internal"><li><a class="tocitem" href="#Introduction"><span>Introduction</span></a></li><li><a class="tocitem" href="#Usage-within-RetrievalToolbox"><span>Usage within RetrievalToolbox</span></a></li></ul></li></ul></li><li><span class="tocitem">Pitfalls</span><ul><li><a class="tocitem" href="../../pitfalls/pitfalls/">Pitfalls</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Working with Julia</a></li><li class="is-active"><a href>Units</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Units</a></li></ul></nav><div class="docs-right"><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="working_with_units"><a class="docs-heading-anchor" href="#working_with_units">Working with Unitful.jl units</a><a id="working_with_units-1"></a><a class="docs-heading-anchor-permalink" href="#working_with_units" title="Permalink"></a></h1><h2 id="Introduction"><a class="docs-heading-anchor" href="#Introduction">Introduction</a><a id="Introduction-1"></a><a class="docs-heading-anchor-permalink" href="#Introduction" title="Permalink"></a></h2><p>The retrieval toolkit currently uses <code>Unitful.jl</code><sup class="footnote-reference"><a id="citeref-Unitful" href="#footnote-Unitful" class="footnote-ref">[Unitful]</a><span class="footnote-preview" id="fn-Unitful"></span></sup> to attach physical units to various quantities that need them. This section here will present a short introduction to the package as well introduce helpful code snippets that should be used when working with RE. Some of these are currently used throughout the package to make sure that calculations are unit-aware.</p><p><code>Unitful.jl</code> introduces new types which allows users to perform calculations that respect the units of quantities of those types. For example, adding various length-type quantities triggers automatic unit conversions (<code>using Unitful.jl</code> is assumed for all code examples).</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; 5.2u&quot;m&quot; + 123.5u&quot;inch&quot; - 0.005u&quot;mi&quot;</code><code class="nohighlight hljs ansi" style="display:block;">0.29017999999999944 m</code></pre><p>Performing e.g. an addition with quantities of incompatible units will raise an error.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; 10.0u&quot;m&quot; + 5.0u&quot;kg&quot;</code><code class="nohighlight hljs ansi" style="display:block;">ERROR: DimensionError: 10.0 m and 5.0 kg are not dimensionally compatible.</code></pre><p>In general, most types of numbers and arrays can be outfitted with a physical unit, and most basic computations with them will involve the automatic checks for compatible dimensions and, if needed, unit conversions.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; [1., 2., 3., 4.] * u&quot;Pa&quot; + [0.05, 0.06, 0.07, 0.08] * u&quot;Torr&quot;</code><code class="nohighlight hljs ansi" style="display:block;">4-element Vector{Unitful.Quantity{Float64, ğŒ ğ‹^-1 ğ“^-2, Unitful.FreeUnits{(kg, m^-1, s^-2), ğŒ ğ‹^-1 ğ“^-2, nothing}}}:
  7.666118421052632 kg m^-1 s^-2
  9.999342105263157 kg m^-1 s^-2
 12.332565789473685 kg m^-1 s^-2
 14.66578947368421 kg m^-1 s^-2</code></pre><p>Note that in the example above, the resulting quantity is not in units of Pascal, but in kg mâ»Â¹ sâ»Â², since <code>Unitful.jl</code> will usually default to SI units once a conversion has taken place. This behavior can be controlled, however, more details are found in the <code>Unitful.jl</code> documentation.</p><p>One can force unit conversion to any compatible unit via the <code>uconvert</code> function (note the broadcasting - <code>uconvert</code> does not dispatch on arrays or vectors).</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; x = [1., 2., 3., 4.] * u&quot;Pa&quot; + [0.05, 0.06, 0.07, 0.08] * u&quot;Torr&quot;</code><code class="nohighlight hljs ansi" style="display:block;">4-element Vector{Unitful.Quantity{Float64, ğŒ ğ‹^-1 ğ“^-2, Unitful.FreeUnits{(kg, m^-1, s^-2), ğŒ ğ‹^-1 ğ“^-2, nothing}}}:
  7.666118421052632 kg m^-1 s^-2
  9.999342105263157 kg m^-1 s^-2
 12.332565789473685 kg m^-1 s^-2
 14.66578947368421 kg m^-1 s^-2</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; uconvert.(Ref(u&quot;Pa&quot;), x)</code><code class="nohighlight hljs ansi" style="display:block;">4-element Vector{Unitful.Quantity{Float64, ğŒ ğ‹^-1 ğ“^-2, Unitful.FreeUnits{(Pa,), ğŒ ğ‹^-1 ğ“^-2, nothing}}}:
  7.666118421052632 Pa
  9.999342105263157 Pa
 12.332565789473685 Pa
 14.66578947368421 Pa</code></pre><p>In the example above, it is important to understand that the object <code>x</code> is a vector of <em>pressure-type</em> units. Julia allows for the mixing of types within a vector, so one can feasibly have a vector or array with mixed units. In this next example, we have three quantities of different units, although Julia will convert the quantities into <code>Float64</code>, even though the elements are initially typed as <code>Float64</code>, <code>Float32</code> and <code>Int64</code>.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; [1.0u&quot;m&quot;, 5.0f0u&quot;kg&quot;, 20u&quot;s&quot;]</code><code class="nohighlight hljs ansi" style="display:block;">3-element Vector{Unitful.Quantity{Float64}}:
  1.0 m
  5.0 kg
 20.0 s</code></pre><p>In general, computations with <code>Unitful</code>-type arrays tend to be almost as fast as those with &quot;raw&quot; arrays of type <code>Float32</code> or <code>Float64</code>. One of the exceptions is exponentiation with non-integer valued exponents, as shown below.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; using BenchmarkTools</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; N = 16;</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; A = rand(Float32, N, N);</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; A_u = A * u&quot;Pa&quot;;</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; @benchmark A.^3.5 seconds=1</code><code class="nohighlight hljs ansi" style="display:block;">BenchmarkTools.Trial: 10000 samples with 5 evaluations per sample.
 Range <span class="sgr90">(</span><span class="sgr36"><span class="sgr1">min</span></span> â€¦ <span class="sgr35">max</span><span class="sgr90">):  </span><span class="sgr36"><span class="sgr1">6.220 Î¼s</span></span> â€¦ <span class="sgr35"> 84.361 Î¼s</span>  <span class="sgr90">â”Š</span> GC <span class="sgr90">(</span>min â€¦ max<span class="sgr90">): </span>0.00% â€¦ 0.00%
 Time  <span class="sgr90">(</span><span class="sgr34"><span class="sgr1">median</span></span><span class="sgr90">):     </span><span class="sgr34"><span class="sgr1">6.380 Î¼s               </span></span><span class="sgr90">â”Š</span> GC <span class="sgr90">(</span>median<span class="sgr90">):    </span>0.00%
 Time  <span class="sgr90">(</span><span class="sgr32"><span class="sgr1">mean</span></span> Â± <span class="sgr32">Ïƒ</span><span class="sgr90">):   </span><span class="sgr32"><span class="sgr1">6.465 Î¼s</span></span> Â± <span class="sgr32">838.727 ns</span>  <span class="sgr90">â”Š</span> GC <span class="sgr90">(</span>mean Â± Ïƒ<span class="sgr90">):  </span>0.00% Â± 0.00%

   â–„â–‡â–ˆâ–ˆâ–ˆ<span class="sgr34">â–ˆ</span>â–‡â–‡â–†<span class="sgr32">â–†</span>â–…â–…â–„â–ƒâ–‚â–â–   â–â–                                     â–ƒ
  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ<span class="sgr34">â–ˆ</span>â–ˆâ–ˆâ–ˆ<span class="sgr32">â–ˆ</span>â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‡â–‡â–†â–†â–†â–‡â–‡â–‡â–ˆâ–‡â–‡â–†â–‡â–…â–‡â–†â–‡â–‡â–‡â–‡â–ˆâ–†â–‡â–ˆâ–ˆâ–‡â–†â–†â–†â–†â–†â–†â–…â–… â–ˆ
  6.22 Î¼s<span class="sgr90">      Histogram: <span class="sgr1">log(</span>frequency<span class="sgr1">)</span> by time</span>      7.69 Î¼s <span class="sgr1">&lt;</span>

 Memory estimate<span class="sgr90">: </span><span class="sgr33">2.12 KiB</span>, allocs estimate<span class="sgr90">: </span><span class="sgr33">4</span>.</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; @benchmark A_u.^3.5 seconds=1</code><code class="nohighlight hljs ansi" style="display:block;">BenchmarkTools.Trial: 825 samples with 1 evaluation per sample.
 Range <span class="sgr90">(</span><span class="sgr36"><span class="sgr1">min</span></span> â€¦ <span class="sgr35">max</span><span class="sgr90">):  </span><span class="sgr36"><span class="sgr1">1.156 ms</span></span> â€¦ <span class="sgr35"> 1.646 ms</span>  <span class="sgr90">â”Š</span> GC <span class="sgr90">(</span>min â€¦ max<span class="sgr90">): </span>0.00% â€¦ 0.00%
 Time  <span class="sgr90">(</span><span class="sgr34"><span class="sgr1">median</span></span><span class="sgr90">):     </span><span class="sgr34"><span class="sgr1">1.176 ms              </span></span><span class="sgr90">â”Š</span> GC <span class="sgr90">(</span>median<span class="sgr90">):    </span>0.00%
 Time  <span class="sgr90">(</span><span class="sgr32"><span class="sgr1">mean</span></span> Â± <span class="sgr32">Ïƒ</span><span class="sgr90">):   </span><span class="sgr32"><span class="sgr1">1.211 ms</span></span> Â± <span class="sgr32">74.156 Î¼s</span>  <span class="sgr90">â”Š</span> GC <span class="sgr90">(</span>mean Â± Ïƒ<span class="sgr90">):  </span>0.00% Â± 0.00%

  â–ˆâ–ˆâ–†<span class="sgr34">â–ƒ</span>â–‚â– <span class="sgr32"> </span>   â–ƒâ–‡â–†â–ƒâ–                                           
  â–ˆâ–ˆâ–ˆ<span class="sgr34">â–ˆ</span>â–ˆâ–ˆâ–‡<span class="sgr32">â–‡</span>â–†â–„â–†â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–†â–†â–â–†â–…â–â–â–„â–â–â–â–â–„â–â–…â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–…â–†â–„â–…â–† â–ˆ
  1.16 ms<span class="sgr90">      Histogram: <span class="sgr1">log(</span>frequency<span class="sgr1">)</span> by time</span>     1.58 ms <span class="sgr1">&lt;</span>

 Memory estimate<span class="sgr90">: </span><span class="sgr33">330.45 KiB</span>, allocs estimate<span class="sgr90">: </span><span class="sgr33">7436</span>.</code></pre><p>Various linear algebra operations can be performed with <code>Unitful</code> quantities, such as the inverse of a square matrix, and the units of the returned object will be correct.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; A = rand(5, 5) * u&quot;kg&quot;;</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; inv(A)</code><code class="nohighlight hljs ansi" style="display:block;">5Ã—5 reinterpret(Unitful.Quantity{Float64, ğŒ^-1, Unitful.FreeUnits{(kg^-1,), ğŒ^-1, nothing}}, ::Matrix{Float64}):
  0.160848 kg^-1   4.26028 kg^-1    â€¦  -3.45248 kg^-1    4.04787 kg^-1
 -0.967014 kg^-1   0.0432137 kg^-1      0.185226 kg^-1   2.34916 kg^-1
  1.6333 kg^-1     0.327653 kg^-1       0.326426 kg^-1  -0.813397 kg^-1
 -0.217657 kg^-1  -2.80903 kg^-1        1.67051 kg^-1   -2.20784 kg^-1
 -0.167075 kg^-1  -0.232778 kg^-1       1.08041 kg^-1   -1.30035 kg^-1</code></pre><p>On the other hand, computing the QR-decomposition on such a matrix will fail.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; using LinearAlgebra</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; A = rand(5, 5) * u&quot;kg&quot;;</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; qr(A)</code><code class="nohighlight hljs ansi" style="display:block;">ERROR: DimensionError: kg and 0.059871493058149435 are not dimensionally compatible.</code></pre><div class="admonition is-warning" id="Warning-c68a477a92ebc456"><header class="admonition-header">Warning<a class="admonition-anchor" href="#Warning-c68a477a92ebc456" title="Permalink"></a></header><div class="admonition-body"><p>Many functions, especially those that call lower-level routines (such as BLAS), might not be compatible with <code>Unitful</code> quantities, or arrays composed of them!</p></div></div><p>While the result of certain linear algebra operations using matrices with physical units might make sense intuitively, others might not be well-defined. Further, it depends highly on the actual implementation and it is difficult to know whether a certain piece of Julia code will execute for a vector or matrix that has <code>Unitful</code> units attached to them.</p><h2 id="Usage-within-RetrievalToolbox"><a class="docs-heading-anchor" href="#Usage-within-RetrievalToolbox">Usage within RetrievalToolbox</a><a id="Usage-within-RetrievalToolbox-1"></a><a class="docs-heading-anchor-permalink" href="#Usage-within-RetrievalToolbox" title="Permalink"></a></h2><p>It is possible to use <code>Unitful</code> quantities directly in custom types and perform calculations using objects of those types. The convenience of this approach is clear: since every variable has units attached to them, an error will be raised immediately when an incompatible computation is performed. So if some part of a computation is accidentally mistyped and results in an operation that is not valid from a physical unit perspective, such as adding pressure and temperature, the code will not successfully execute. Further, if the computations themselves implicitly perform the required unit conversions, users do not need to write code that takes care of possible unit conversions. In addition to that, a flexible unit system allows users to choose their units of preference, e.g. state their pressures in &quot;hPa&quot; rather than &quot;Pa&quot;.</p><p>There are currently two major drawbacks that were identified during the development of RetrievalToolbox when trying to use vectors and matrices of some <code>Unitful</code> type.</p><ol><li>Some linear algebra operations were fundamentally incompatible with <code>Unitful</code> matrices</li><li>Some operations (e.g. exponentiation, taking the logarithm) suffered from performance drops</li></ol><p>Regarding (1), most computations can be performed with <code>Unitful</code> vectors and matrices without having to adapt the code. Various linear algebra operations, however, as is necessary for the inversion, require matrices that by definition have mixed units. If <code>Unitful</code> is consistently used for all quantities, then the prior covariance matrix for an OE-type retrieval, for example, will have various units for the quantities that occur within the matrix. While the inversion equations obviously are consistent in terms of their physical units, some of the linear algebra operations (e.g. computing the inverse of a larger matrix might use decomposition techniques) will fail since those tend to be optimized for numerical efficiency and might contain incompatible sub-operations. This issue can be circumvented by casting a <code>Unitful</code> matrix into a regular &quot;numeric&quot; matrix, performing the needed calculations, and then re-attaching the units at a later stage.</p><p>A similar solution can be used for (2) by identifying which operations suffer from performance issues and making sure that those will be executed for regular matrices and vectors, rather than involving the <code>Unitful</code> types.</p><p>The current implementation of physical units in RetrievalToolbox uses a hybrid and more explicit approach. Every custom type with a field that should have a physical unit, also has a field that contains the physical unit. As an example, a <code>GasAbsorber</code> contains a volume mixing ratio profile <code>vmr_levels</code>. We want to give users the option to define a VMR profile in various units, such as ppb when working with methane, or ppm when working with carbon dioxide. So for the <code>vmr_levels</code> field, there is an accompanying field <code>vmr_unit</code> which carries the <code>Unitful</code> type that describes the physical unit.</p><pre><code class="language-julia hljs">struct GasAbsorber{T} &lt;: AbstractAtmosphereElement where T

    gas_name::String
    spectroscopy::AbstractSpectroscopy
    vmr_levels::Vector{T}
    vmr_unit::Unitful.DimensionlessUnits

end</code></pre><p>Note that above, we can not only demand that the user instantiate the object with a <code>Unitful</code> type, but we can also make sure that the assigned unit makes sense for this particular object. Volume mixing ratios should be dimensionless (or dimension 1), and <code>Unitful</code> provides a type that represents all the explicit types. There are many other types that fall into the same category, we can use e.g. <code>Unitful.LengthUnits</code> if we want to force any type of length unit.</p><p>Of course now, users and code maintainers must use explicitly use the unit information and make sure that possible unit conversions are taken into account when they need to be. For dimensionless units, the situation is straightforward, since applying the <code>NoUnits</code> function will convert the dimensionless quantity into parts.</p><p>Users and code maintainers must ensure the appropriate use, and below we demonstrate the general idea with examples.</p><p>For example one, we have two dimensionless quantities <code>x</code> and <code>y</code>. Both <code>x</code> and <code>y</code> are <code>Float64</code> in this case, and their associated units are stored in separate variables <code>x_u</code> and <code>y_u</code>. If we have to compute a new quantity <code>x + y</code>, we must first make sure the units of each are considered.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; x = 1.234;</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; x_u = u&quot;ppm&quot;;</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; y = 1500.0;</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; y_u = u&quot;ppb&quot;;</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; y * y_u + x * x_u |&gt; NoUnits</code><code class="nohighlight hljs ansi" style="display:block;">2.734e-6</code></pre><p>In the next example, we consider two pressure values <code>p1</code> and <code>p2</code> whose units <code>p1_u</code> and <code>p2_u</code> are not necessarily the same. Let us assume that we must carry on the computation in units of <code>p2_u</code>. The function <code>ustrip</code> provided by <code>Unitful</code> is very helpful in this way. When called with a <code>Unitful</code> quantity alone, the unit will be simply stripped, and the numeric value is retained, e.g. <code>ustrip(123.0u&quot;hPa&quot;)</code> returns <code>123.0</code>. However, when we call <code>ustrip</code> with a leading argument, being a compatible unit, the quantity will first be converted to that unit. <code>ustrip(u&quot;Pa&quot;, 123.0u&quot;hPa&quot;)</code> will return <code>12300.0</code>.</p><p>In the first variant of performing <code>p1 + p2</code>, we first construct <code>Unitful</code> quantities by multiplying each pressure value by its respective unit, <code>p1 * p1_u</code> and <code>p2 * p2_u</code>, and then perform the sum. The intermediate sum will be in SI pressure units, but then we apply the <code>ustrip</code> function to convert the sum into units of <code>p2_u</code> and strip the unit to obtain the numerical value only.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; #=
           Version 1
       =#
       p1 = 1100.0; p1_u = u&quot;hPa&quot;;</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; p2 = 55.5; p2_u = u&quot;Pa&quot;;</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; result = ustrip(p2_u, p1 * p1_u + p2 * p2_u)</code><code class="nohighlight hljs ansi" style="display:block;">110055.5</code></pre><p>In the second variant demonstrated here we first construct <code>p1 * p1_u</code> to obtain a <code>Unitful</code> object, which yields 1100.0 hPa, and immediately convert it into units of <code>p2_u</code> (Pa) and stripping the unit, such that this new variable <code>tmp</code> becomes <code>110000.0</code>. Now we have pressure <code>p1</code> as a numerical value in units of Pa (implicit), and can simply add it to <code>p2</code> to obtain the same result as above.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; #=
           Version 2
       =#
       p1 = 1100.0; p1_u = u&quot;hPa&quot;;</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; p2 = 55.5; p2_u = u&quot;Pa&quot;;</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; tmp = ustrip(p2_u, p1 * p1_u);</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; result = p2 + tmp</code><code class="nohighlight hljs ansi" style="display:block;">110055.5</code></pre><p>Throughout RetrievalToolbox both variants are applied.</p><section class="footnotes is-size-7"><ul><li class="footnote" id="footnote-Unitful"><a class="tag is-link" href="#citeref-Unitful">Unitful</a><a href="https://github.com/PainterQubits/Unitful.jl">https://github.com/PainterQubits/Unitful.jl</a></li></ul></section></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../dicts/">Â« Dictionaries</a><a class="docs-footer-nextpage" href="../../pitfalls/pitfalls/">Pitfalls Â»</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.1 on <span class="colophon-date" title="Friday 12 December 2025 20:23">Friday 12 December 2025</span>. Using Julia version 1.12.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
