<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Pitfalls · RetrievalToolbox.jl</title><meta name="title" content="Pitfalls · RetrievalToolbox.jl"/><meta property="og:title" content="Pitfalls · RetrievalToolbox.jl"/><meta property="twitter:title" content="Pitfalls · RetrievalToolbox.jl"/><meta name="description" content="Documentation for RetrievalToolbox.jl."/><meta property="og:description" content="Documentation for RetrievalToolbox.jl."/><meta property="twitter:description" content="Documentation for RetrievalToolbox.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">RetrievalToolbox.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Main</a></li><li><span class="tocitem">Concepts</span><ul><li><a class="tocitem" href="../../concepts/fundamentals/">Fundamentals</a></li><li><a class="tocitem" href="../../concepts/core_concepts/">Core Concepts</a></li><li><a class="tocitem" href="../../concepts/radiance/">Radiance</a></li><li><a class="tocitem" href="../../concepts/phasefunction/">Scattering Phasefunction</a></li></ul></li><li><a class="tocitem" href="../../design/design/">Design</a></li><li><span class="tocitem">Functions</span><ul><li><a class="tocitem" href="../../functions/state_vector_functions/">State Vector Functions</a></li><li><a class="tocitem" href="../../functions/atmosphere_functions/">Atmosphere Functions</a></li><li><a class="tocitem" href="../../functions/instrument_functions/">Instrument Functions</a></li></ul></li><li><span class="tocitem">Types</span><ul><li><a class="tocitem" href="../../types/atmosphere_types/">Atmosphere Types</a></li><li><a class="tocitem" href="../../types/buffer_types/">Buffer Types</a></li><li><a class="tocitem" href="../../types/dispersion_types/">Dispersion Types</a></li><li><a class="tocitem" href="../../types/RT_types/">Radiative Transfer Method Types</a></li><li><a class="tocitem" href="../../types/state_vector_types/">State Vector Types</a></li><li><a class="tocitem" href="../../types/surface_types/">Surface Types</a></li></ul></li><li><span class="tocitem">Working with Julia</span><ul><li><a class="tocitem" href="../../julia/develop/">Develop</a></li><li><a class="tocitem" href="../../julia/dicts/">Dictionaries</a></li><li><a class="tocitem" href="../../julia/units/">Units</a></li></ul></li><li><span class="tocitem">Pitfalls</span><ul><li class="is-active"><a class="tocitem" href>Pitfalls</a><ul class="internal"><li><a class="tocitem" href="#Azimuthal-angles-and-convention-for-use-with-XRTM"><span>Azimuthal angles and convention for use with XRTM</span></a></li><li><a class="tocitem" href="#Mutability-of-many-RetrievalToolbox-objects"><span>Mutability of many RetrievalToolbox objects</span></a></li><li><a class="tocitem" href="#Angles-and-trigonometric-functions-with-Unitful.jl"><span>Angles and trigonometric functions with Unitful.jl</span></a></li></ul></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Pitfalls</a></li><li class="is-active"><a href>Pitfalls</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Pitfalls</a></li></ul></nav><div class="docs-right"><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Known-pitfalls-and-issues"><a class="docs-heading-anchor" href="#Known-pitfalls-and-issues">Known pitfalls &amp; issues</a><a id="Known-pitfalls-and-issues-1"></a><a class="docs-heading-anchor-permalink" href="#Known-pitfalls-and-issues" title="Permalink"></a></h1><p>This section of the documentation deals with known pitfalls regarding the usage of the toolkit, as well as more structural issues. Due to the highly modular philosophy of this software, many critical portions of an algorithm implementation are up to the user and, by design, not part of the toolkit itself. Thus, it is easily possible to <em>break</em> some of the intended program flow.</p><h2 id="Azimuthal-angles-and-convention-for-use-with-XRTM"><a class="docs-heading-anchor" href="#Azimuthal-angles-and-convention-for-use-with-XRTM">Azimuthal angles and convention for use with XRTM</a><a id="Azimuthal-angles-and-convention-for-use-with-XRTM-1"></a><a class="docs-heading-anchor-permalink" href="#Azimuthal-angles-and-convention-for-use-with-XRTM" title="Permalink"></a></h2><h2 id="Mutability-of-many-RetrievalToolbox-objects"><a class="docs-heading-anchor" href="#Mutability-of-many-RetrievalToolbox-objects">Mutability of many RetrievalToolbox objects</a><a id="Mutability-of-many-RetrievalToolbox-objects-1"></a><a class="docs-heading-anchor-permalink" href="#Mutability-of-many-RetrievalToolbox-objects" title="Permalink"></a></h2><h2 id="Angles-and-trigonometric-functions-with-Unitful.jl"><a class="docs-heading-anchor" href="#Angles-and-trigonometric-functions-with-Unitful.jl">Angles and trigonometric functions with Unitful.jl</a><a id="Angles-and-trigonometric-functions-with-Unitful.jl-1"></a><a class="docs-heading-anchor-permalink" href="#Angles-and-trigonometric-functions-with-Unitful.jl" title="Permalink"></a></h2><p>In Julia, calling trigonometric functions is straightforward, with angles being naturally considered to be in units of radiants:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; sin(pi/2)</code><code class="nohighlight hljs ansi" style="display:block;">1.0</code></pre><p>There are also trigonometric functions that ingest angles in degrees, which are conveniently named the same but append a <code>d</code> at the end, e.g. <code>sin</code> becomes <code>sind</code>, or <code>cos</code> becomes <code>cosd</code>. The behavior is as expected</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; sind(90.0)</code><code class="nohighlight hljs ansi" style="display:block;">1.0</code></pre><p>When using the Unitful.jl package, one can attach appropriate units to angle values. The library also provides an implementation of the common trigonometric functions such that the appropriate unit conversions take place internally:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; x = 90u&quot;°&quot;</code><code class="nohighlight hljs ansi" style="display:block;">90°</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; sin(x)</code><code class="nohighlight hljs ansi" style="display:block;">1.0</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; cos(x)</code><code class="nohighlight hljs ansi" style="display:block;">0.0</code></pre><p>Similarly, the <code>cosd</code> and <code>sind</code> functions as provided by Unitful.jl accept degree-valued quantities that provide the correct result. In the case of some degree-valued quantity, <code>x</code>, the result happens to the same:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; x = 55u&quot;°&quot;</code><code class="nohighlight hljs ansi" style="display:block;">55°</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; sin(x)</code><code class="nohighlight hljs ansi" style="display:block;">0.8191520442889918</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; sind(x)</code><code class="nohighlight hljs ansi" style="display:block;">0.8191520442889918</code></pre><p>Looking closer into what functions are called, we observe that <code>sin</code> and <code>sind</code> provide the interface to the correct function when the argument is a degree-valued quantity. However if the argument is radians-valued, <code>sind</code> will not perform the appropriate conversion!</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; x = 45u&quot;°&quot;</code><code class="nohighlight hljs ansi" style="display:block;">45°</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; y = (pi/4)u&quot;rad&quot;</code><code class="nohighlight hljs ansi" style="display:block;">0.7853981633974483 rad</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; code_lowered(sin, tuple(typeof(x)))</code><code class="nohighlight hljs ansi" style="display:block;">1-element Vector{Core.CodeInfo}:
 CodeInfo(
<span class="sgr90">1 ─</span> %1 = Unitful.sind
<span class="sgr90">│  </span> %2 = Unitful.ustrip
<span class="sgr90">│  </span> %3 = <span class="sgr33">  dynamic </span>(%2)(x)
<span class="sgr90">│  </span> %4 = <span class="sgr33">  dynamic </span>(%1)(%3)
<span class="sgr90">└──</span>      return %4
)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; code_lowered(sind, tuple(typeof(x)))</code><code class="nohighlight hljs ansi" style="display:block;">1-element Vector{Core.CodeInfo}:
 CodeInfo(
<span class="sgr90">1 ─</span> %1 = Unitful.sind
<span class="sgr90">│  </span> %2 = Unitful.ustrip
<span class="sgr90">│  </span> %3 = <span class="sgr33">  dynamic </span>(%2)(x)
<span class="sgr90">│  </span> %4 = <span class="sgr33">  dynamic </span>(%1)(%3)
<span class="sgr90">└──</span>      return %4
)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; code_lowered(sin, tuple(typeof(y)))</code><code class="nohighlight hljs ansi" style="display:block;">1-element Vector{Core.CodeInfo}:
 CodeInfo(
<span class="sgr90">1 ─</span> %1 = Unitful.Base
<span class="sgr90">│  </span> %2 = <span class="sgr33">  dynamic </span>Base.getproperty(%1, :sin)
<span class="sgr90">│  </span> %3 = Unitful.uconvert
<span class="sgr90">│  </span> %4 = Unitful.NoUnits
<span class="sgr90">│  </span> %5 = <span class="sgr33">  dynamic </span>(%3)(%4, x)
<span class="sgr90">│  </span> %6 = <span class="sgr33">  dynamic </span>(%2)(%5)
<span class="sgr90">└──</span>      return %6
)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; code_lowered(sind, tuple(typeof(y)))</code><code class="nohighlight hljs ansi" style="display:block;">1-element Vector{Core.CodeInfo}:
 CodeInfo(
<span class="sgr90">1 ─</span> %1 = Base.Math.sin
<span class="sgr90">│  </span> %2 = Base.Math.deg2rad
<span class="sgr90">│  </span> %3 = <span class="sgr33">  dynamic </span>Base.broadcasted(%2, x)
<span class="sgr90">│  </span> %4 = <span class="sgr33">  dynamic </span>Base.materialize(%3)
<span class="sgr90">│  </span> %5 = <span class="sgr33">  dynamic </span>(%1)(%4)
<span class="sgr90">└──</span>      return %5
)</code></pre><p>The code block above shows that <code>sind</code>, when called with a radians-valued quantity will simply perform a <code>deg2rad</code> conversion and use the <code>sin</code> function on the argument. More importantly, no error will be thrown when such a computation is attempted!</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; y = (pi/4)u&quot;rad&quot;</code><code class="nohighlight hljs ansi" style="display:block;">0.7853981633974483 rad</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; z = y |&gt; u&quot;°&quot;</code><code class="nohighlight hljs ansi" style="display:block;">45.0°</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; # This is not what we want!
       sind(y)</code><code class="nohighlight hljs ansi" style="display:block;">0.013707354604707475</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; # This is!
       sind(z)</code><code class="nohighlight hljs ansi" style="display:block;">0.7071067811865476</code></pre><div class="admonition is-warning" id="Warning-84655c1cb041f644"><header class="admonition-header">Warning<a class="admonition-anchor" href="#Warning-84655c1cb041f644" title="Permalink"></a></header><div class="admonition-body"><p>Trigonometric functions meant for degree-valued arguments, such as <code>sind</code> or <code>cosd</code> do not perform automatic unit conversions, even if the argument is a <code>Unitful</code> quantity! Calculating <code>cosd((pi/2)u&quot;rad&quot;)</code> will yield an unexpected answer!</p></div></div><div class="admonition is-success" id="Tip-29e485634010e574"><header class="admonition-header">Tip<a class="admonition-anchor" href="#Tip-29e485634010e574" title="Permalink"></a></header><div class="admonition-body"><p>It is best-practice to clearly document which units certain angle variables must have, and then use the appropriate trigonometric functions! Always use e.g. <code>cosd</code> when degree-valued angles are expected, but use e.g. <code>cos</code> if a <code>Unitful</code> angle quantity is expected.</p></div></div><p>Further, users should be aware of implicit conversions when assigning angle-valued quantities to object fields. This is a particular danger with buffers, as those are instantiated and then modified in-place at some later point. The example below illustrates the issue.</p><p>Assume some mutable, user-defined type <code>t</code> that accepts some float as its only field. We then instantiate a new variable <code>v</code> with some arbitrary value.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; mutable struct t{T &lt;: AbstractFloat}
           a::T
       end</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; v = t(123.456)</code><code class="nohighlight hljs ansi" style="display:block;">Main.t{Float64}(123.456)</code></pre><p>At some later point, we would like to change <code>v.a</code>. For the sake of this example, assume we want to give it the value of 15 degrees. Following code executes without raising an error.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; v.a = 15.0u&quot;°&quot;</code><code class="nohighlight hljs ansi" style="display:block;">15.0°</code></pre><p>Yet, when we inspect the value <code>v.a</code> itself, we see that an implicit conversion has taken place which turned the 15° into equivalent radians. The conversion happened since angular units are dimensionless, or have dimension [1], so can always be turned into a <code>Unitful.NoUnits</code> quantity which then can be cast into a &quot;regular&quot; Julia number. Some function which might perform a calculation on some object of this type, therefore should not use the degree-versions of trigonometric functions.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; v.a</code><code class="nohighlight hljs ansi" style="display:block;">0.2617993877991494</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; deg2rad(15.0)</code><code class="nohighlight hljs ansi" style="display:block;">0.2617993877991494</code></pre><div class="admonition is-warning" id="Warning-d73a31405a4790b0"><header class="admonition-header">Warning<a class="admonition-anchor" href="#Warning-d73a31405a4790b0" title="Permalink"></a></header><div class="admonition-body"><p><code>Unitful</code> angle-valued quantities are prone to implicit conversions to radians!</p></div></div></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../julia/units/">« Units</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.1 on <span class="colophon-date" title="Thursday 8 January 2026 18:07">Thursday 8 January 2026</span>. Using Julia version 1.12.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
