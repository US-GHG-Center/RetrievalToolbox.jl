<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Atmosphere Functions ¬∑ RetrievalToolbox.jl</title><meta name="title" content="Atmosphere Functions ¬∑ RetrievalToolbox.jl"/><meta property="og:title" content="Atmosphere Functions ¬∑ RetrievalToolbox.jl"/><meta property="twitter:title" content="Atmosphere Functions ¬∑ RetrievalToolbox.jl"/><meta name="description" content="Documentation for RetrievalToolbox.jl."/><meta property="og:description" content="Documentation for RetrievalToolbox.jl."/><meta property="twitter:description" content="Documentation for RetrievalToolbox.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">RetrievalToolbox.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Main</a></li><li><span class="tocitem">Concepts</span><ul><li><a class="tocitem" href="../../concepts/fundamentals/">Fundamentals</a></li><li><a class="tocitem" href="../../concepts/core_concepts/">Core Concepts</a></li><li><a class="tocitem" href="../../concepts/radiance/">Radiance</a></li><li><a class="tocitem" href="../../concepts/phasefunction/">Scattering Phasefunction</a></li></ul></li><li><a class="tocitem" href="../../design/design/">Design</a></li><li><span class="tocitem">Functions</span><ul><li><a class="tocitem" href="../state_vector_functions/">State Vector Functions</a></li><li class="is-active"><a class="tocitem" href>Atmosphere Functions</a><ul class="internal"><li><a class="tocitem" href="#Updates-and-roll-backs"><span>Updates and roll-backs</span></a></li><li><a class="tocitem" href="#List-of-atmosphere-functions"><span>List of atmosphere functions</span></a></li></ul></li><li><a class="tocitem" href="../instrument_functions/">Instrument Functions</a></li></ul></li><li><span class="tocitem">Types</span><ul><li><a class="tocitem" href="../../types/atmosphere_types/">Atmosphere Types</a></li><li><a class="tocitem" href="../../types/buffer_types/">Buffer Types</a></li><li><a class="tocitem" href="../../types/dispersion_types/">Dispersion Types</a></li><li><a class="tocitem" href="../../types/RT_types/">Radiative Transfer Method Types</a></li><li><a class="tocitem" href="../../types/state_vector_types/">State Vector Types</a></li><li><a class="tocitem" href="../../types/surface_types/">Surface Types</a></li></ul></li><li><span class="tocitem">Working with Julia</span><ul><li><a class="tocitem" href="../../julia/develop/">Develop</a></li><li><a class="tocitem" href="../../julia/dicts/">Dictionaries</a></li><li><a class="tocitem" href="../../julia/units/">Units</a></li></ul></li><li><span class="tocitem">Pitfalls</span><ul><li><a class="tocitem" href="../../pitfalls/pitfalls/">Pitfalls</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Functions</a></li><li class="is-active"><a href>Atmosphere Functions</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Atmosphere Functions</a></li></ul></nav><div class="docs-right"><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Atmosphere-functions"><a class="docs-heading-anchor" href="#Atmosphere-functions">Atmosphere functions</a><a id="Atmosphere-functions-1"></a><a class="docs-heading-anchor-permalink" href="#Atmosphere-functions" title="Permalink"></a></h1><p>Functions below are designed to operate on atmosphere object, and for the time being mostly on <code>EarthAtmosphere</code> ones.</p><h2 id="Updates-and-roll-backs"><a class="docs-heading-anchor" href="#Updates-and-roll-backs">Updates and roll-backs</a><a id="Updates-and-roll-backs-1"></a><a class="docs-heading-anchor-permalink" href="#Updates-and-roll-backs" title="Permalink"></a></h2><p>Atmosphere objects, just as <code>EarthAtmosphere</code>, are generally mutated during the course of an inverse retrieval problem. There is no &quot;history&quot; per se that would allow to unambiguously re-create the atmospheric state at some earlier iteration. Due to the flexibility of the toolset, it is always possible to make changes (intentional or not) to the atmospheric state that would be difficult to revert.</p><p>The mechanism that is used in RetrievalToolbox relies on user discipline. Let <code>atm</code> be an <code>EarthAtmosphere</code> that has been initialized and adjusted to the user&#39;s wishes, and let <code>SV</code> be a <code>RetrievalStateVector</code> that contains state vector elements that imply some modification of the contents of <code>atm</code>.</p><p>For some parts of the atmosphere, their state can be easily and directly inferred from a state vector element. As an example we can look at <code>SurfacePressureSVE</code>: the lowest pressure level is simply set to the <em>current</em> value of that state vector element via the <code>atmosphere_element_statevector_update!</code> function. One can think of the surface pressure of the model atmosphere being quite rigidly controlled, it will simply take on whatever value <code>SurfacePressureSVE</code> currently has. This allows us to also recreate the surface pressure that was present at an earlier iteration. We could manipulate the contents of the <code>.iterations</code> field of the <code>SurfacePressureSVE</code> object, i.e. remove entries up to the requested iteration number. When we call <code>atmosphere_element_statevector_update!</code> again, the atmosphere will revert back to that earlier state.</p><p>The above holds true for many state vector elements that control the atmospheric state, like the <code>GasVMRProfileSVE</code> which defines the volume mixing ratio profile of a certain gas in that model atmosphere, or <code>SIFRadianceSVE</code> which defines the magnitude of surface-leaving fluorescence radiance emission.</p><p>There are notable exceptions, for which this concept does not work - at least not reliably. <code>GasLevelScalingFactorSVE</code>, for example, scales the <em>initial</em> gas profile by some factor. Similarly, <code>TemperatureOffsetSVE</code> adds some value to the <em>initial</em> temperature profile. While it is mathematically straightforward to reconstruct the these profiles from the implicit history of iterations that is found in the <code>.iterations</code> vectors of these state vector elements, it has proven to be not fully reliable in practice.</p><p>Instead, RetrievalToolbox expects users to to call a function <code>atmosphere_element_statevector_rollback!</code> towards the end of their forward model implementation, which re-sets particular atmospheric components to their initial state. Therefore, when a new forward model evaluation is performed, the call to <code>atmosphere_element_statevector_update!</code> will modify those components correctly to the desired state as given by the state vector elements.</p><div class="admonition is-warning" id="Warning-ff9f3497df66340c"><header class="admonition-header">Warning<a class="admonition-anchor" href="#Warning-ff9f3497df66340c" title="Permalink"></a></header><div class="admonition-body"><p><strong>Important!</strong> There is no mechanism to check if the <em>update</em> and <em>rollback</em> functions have been called in a forward model. It is fully up to users to ensure that those calls are made in the forward model in the appropriate places.</p></div></div><p>To summarize, users should make a call to <code>atmosphere_element_statevector_update!</code> towards the beginning of their forward model, and then another call to <code>atmosphere_element_statevector_rollback!</code> towards the end.</p><pre><code class="language-julia hljs"># My forward model

# [...]
for atm_e in atm.atm_elements
    RE.atmosphere_element_statevector_update!(atm_e, SV)
end

# [...]
# calculate radiances, Jacobians etc.
# [...]

for atm_e in atm.atm_elements
    RE.atmosphere_element_statevector_rollback!(atm_e, SV)
end

# [...]
# forward model end</code></pre><div class="admonition is-success" id="Tip-8d95fd1fe010583f"><header class="admonition-header">Tip<a class="admonition-anchor" href="#Tip-8d95fd1fe010583f" title="Permalink"></a></header><div class="admonition-body"><p>Users also must ensure that <code>atmosphere_element_statevector_update!</code> is called <em>after</em> iterations are complete if they want to e.g. calculate some atmospheric quantity corresponding to the final state inferred by the retrieval.</p></div></div><p>Note that the code snipped shows explicit loops over all atmosphere elements <code>atm_e</code> of some atmosphere <code>atm</code>.</p><h2 id="List-of-atmosphere-functions"><a class="docs-heading-anchor" href="#List-of-atmosphere-functions">List of atmosphere functions</a><a id="List-of-atmosphere-functions-1"></a><a class="docs-heading-anchor-permalink" href="#List-of-atmosphere-functions" title="Permalink"></a></h2><article><details class="docstring" open="true"><summary id="RetrievalToolbox.JPL_gravity-Tuple{Number, Number}"><a class="docstring-binding" href="#RetrievalToolbox.JPL_gravity-Tuple{Number, Number}"><code>RetrievalToolbox.JPL_gravity</code></a> ‚Äî <span class="docstring-category">Method</span></summary><section><div><pre><code class="language-julia hljs">JPL_gravity(
    latitude::Number,
    altitude::Number;
    earth_equatorial_radius
) -&gt; Any
</code></pre><p>Calculates local gravity given some latitude and altitude. Note that the altitude can be be a simple number, in which the input is assumed to be in meters. If you supply a <code>Unitful</code> quantity, appropriate unit conversions are done. In either case, this function will return a <code>Unitful</code> quantity that will reduce to acceleration [m s‚Åª¬≤].</p><p><strong>Details</strong></p><p>This code was taken from MS3 / the CSU simulator suite, with heritage related to the OCO-1 retrieval algorithm written at JPL. See https://github.com/nasa/RtRetrievalFramework at <code>./lib/implementation/altitude_hydrostatic.cc</code>.</p></div></section></details></article><article><details class="docstring" open="true"><summary id="RetrievalToolbox.atmosphere_element_statevector_rollback!-Tuple{AbstractAtmosphereElement, AbstractStateVectorElement}"><a class="docstring-binding" href="#RetrievalToolbox.atmosphere_element_statevector_rollback!-Tuple{AbstractAtmosphereElement, AbstractStateVectorElement}"><code>RetrievalToolbox.atmosphere_element_statevector_rollback!</code></a> ‚Äî <span class="docstring-category">Method</span></summary><section><div><pre><code class="language-julia hljs">atmosphere_element_statevector_rollback!(
    atm_element::AbstractAtmosphereElement,
    sve::AbstractStateVectorElement
) -&gt; Any
</code></pre><p>Default behavior: do nothing</p></div></section></details></article><article><details class="docstring" open="true"><summary id="RetrievalToolbox.atmosphere_element_statevector_rollback!-Tuple{GasAbsorber, GasLevelScalingFactorSVE}"><a class="docstring-binding" href="#RetrievalToolbox.atmosphere_element_statevector_rollback!-Tuple{GasAbsorber, GasLevelScalingFactorSVE}"><code>RetrievalToolbox.atmosphere_element_statevector_rollback!</code></a> ‚Äî <span class="docstring-category">Method</span></summary><section><div><pre><code class="language-julia hljs">atmosphere_element_statevector_rollback!(
    atm_element::GasAbsorber,
    sve::GasLevelScalingFactorSVE
) -&gt; Any
</code></pre><p>Rolls back the <code>GasAbsorber</code> volume mixing ratio profile to its first-guess state as defined in <code>sve</code>.</p></div></section></details></article><article><details class="docstring" open="true"><summary id="RetrievalToolbox.atmosphere_element_statevector_update!-Tuple{AbstractAtmosphereElement, AbstractStateVectorElement}"><a class="docstring-binding" href="#RetrievalToolbox.atmosphere_element_statevector_update!-Tuple{AbstractAtmosphereElement, AbstractStateVectorElement}"><code>RetrievalToolbox.atmosphere_element_statevector_update!</code></a> ‚Äî <span class="docstring-category">Method</span></summary><section><div><pre><code class="language-julia hljs">atmosphere_element_statevector_update!(
    atm_element::AbstractAtmosphereElement,
    sve::AbstractStateVectorElement
) -&gt; Any
</code></pre><p>Default function to update the atmosphere element <code>atm_element</code> according to the current value of the state vector element <code>sve</code>. This does nothing!</p></div></section></details></article><article><details class="docstring" open="true"><summary id="RetrievalToolbox.atmosphere_element_statevector_update!-Tuple{GasAbsorber, GasLevelScalingFactorSVE}"><a class="docstring-binding" href="#RetrievalToolbox.atmosphere_element_statevector_update!-Tuple{GasAbsorber, GasLevelScalingFactorSVE}"><code>RetrievalToolbox.atmosphere_element_statevector_update!</code></a> ‚Äî <span class="docstring-category">Method</span></summary><section><div><pre><code class="language-julia hljs">atmosphere_element_statevector_update!(
    atm_element::GasAbsorber,
    sve::GasLevelScalingFactorSVE
) -&gt; Any
</code></pre><p>Updates the <code>GasAbsorber</code> volume mixing ratio profile according to <code>sve</code>.</p></div></section></details></article><article><details class="docstring" open="true"><summary id="RetrievalToolbox.atmosphere_element_statevector_update!-Tuple{GasAbsorber, GasVMRProfileSVE}"><a class="docstring-binding" href="#RetrievalToolbox.atmosphere_element_statevector_update!-Tuple{GasAbsorber, GasVMRProfileSVE}"><code>RetrievalToolbox.atmosphere_element_statevector_update!</code></a> ‚Äî <span class="docstring-category">Method</span></summary><section><div><pre><code class="language-julia hljs">atmosphere_element_statevector_update!(
    atm_element::GasAbsorber,
    sve::GasVMRProfileSVE
) -&gt; Any
</code></pre><p>Updates atmospheric element <code>atm_element</code> if a <code>GasVMRProfileSVE</code> is present.</p></div></section></details></article><article><details class="docstring" open="true"><summary id="RetrievalToolbox.atmosphere_element_statevector_update!-Tuple{SIFRadiance, SIFRadianceSVE}"><a class="docstring-binding" href="#RetrievalToolbox.atmosphere_element_statevector_update!-Tuple{SIFRadiance, SIFRadianceSVE}"><code>RetrievalToolbox.atmosphere_element_statevector_update!</code></a> ‚Äî <span class="docstring-category">Method</span></summary><section><div><pre><code class="language-julia hljs">atmosphere_element_statevector_update!(
    atm_element::SIFRadiance,
    sve::SIFRadianceSVE
) -&gt; Union{Nothing, AbstractFloat}
</code></pre><p>Updates atmospheric element <code>atm_element</code> if a <code>SIFRaidnaceSVE</code> is present.</p></div></section></details></article><article><details class="docstring" open="true"><summary id="RetrievalToolbox.atmosphere_element_statevector_update!-Union{Tuple{T}, Tuple{Vector{T}, AbstractStateVector}} where T&lt;:AbstractAtmosphereElement"><a class="docstring-binding" href="#RetrievalToolbox.atmosphere_element_statevector_update!-Union{Tuple{T}, Tuple{Vector{T}, AbstractStateVector}} where T&lt;:AbstractAtmosphereElement"><code>RetrievalToolbox.atmosphere_element_statevector_update!</code></a> ‚Äî <span class="docstring-category">Method</span></summary><section><div><pre><code class="language-julia hljs">atmosphere_element_statevector_update!(
    atm_elements::Array{T&lt;:AbstractAtmosphereElement, 1},
    SV::AbstractStateVector
)
</code></pre><p>Function to update all atmosphere elements in the vector <code>atm_elements</code> according to the current value of all state vector elements in the state vector <code>SV</code>.</p></div></section></details></article><article><details class="docstring" open="true"><summary id="RetrievalToolbox.atmosphere_statevector_rollback!-Tuple{AbstractAtmosphere, TemperatureOffsetSVE}"><a class="docstring-binding" href="#RetrievalToolbox.atmosphere_statevector_rollback!-Tuple{AbstractAtmosphere, TemperatureOffsetSVE}"><code>RetrievalToolbox.atmosphere_statevector_rollback!</code></a> ‚Äî <span class="docstring-category">Method</span></summary><section><div><pre><code class="language-julia hljs">atmosphere_statevector_rollback!(
    atm::AbstractAtmosphere,
    sve::TemperatureOffsetSVE
) -&gt; Any
</code></pre><p>Rolls back the atmosphere <code>atm</code> for a <code>TemperatureOffsetSVE</code> state vector element.</p></div></section></details></article><article><details class="docstring" open="true"><summary id="RetrievalToolbox.atmosphere_statevector_update!-Tuple{AbstractAtmosphere, TemperatureOffsetSVE}"><a class="docstring-binding" href="#RetrievalToolbox.atmosphere_statevector_update!-Tuple{AbstractAtmosphere, TemperatureOffsetSVE}"><code>RetrievalToolbox.atmosphere_statevector_update!</code></a> ‚Äî <span class="docstring-category">Method</span></summary><section><div><pre><code class="language-julia hljs">atmosphere_statevector_update!(
    atm::AbstractAtmosphere,
    sve::TemperatureOffsetSVE
) -&gt; Any
</code></pre><p>Updates the atmosphere <code>atm</code> for a <code>TemperatureOffsetSVE</code> state vector element.</p></div></section></details></article><article><details class="docstring" open="true"><summary id="RetrievalToolbox.calculate_altitude_and_gravity!-Tuple{EarthScene}"><a class="docstring-binding" href="#RetrievalToolbox.calculate_altitude_and_gravity!-Tuple{EarthScene}"><code>RetrievalToolbox.calculate_altitude_and_gravity!</code></a> ‚Äî <span class="docstring-category">Method</span></summary><section><div><pre><code class="language-julia hljs">calculate_altitude_and_gravity!(scene::EarthScene)
</code></pre><p>Calculates altitude and gravity for an <code>EarthScene</code>, assuming that all other needed quantities have been inserted accordingly, namely: pressure levels, temperatures layers, specific humidity layers and location. Note! Layer-based values are calculated in this function call and overwrite existing values!</p></div></section></details></article><article><details class="docstring" open="true"><summary id="RetrievalToolbox.calculate_altitude_and_gravity_levels!-Tuple{AbstractVector, AbstractVector, AbstractVector, AbstractVector, AbstractVector, Number, EarthLocation}"><a class="docstring-binding" href="#RetrievalToolbox.calculate_altitude_and_gravity_levels!-Tuple{AbstractVector, AbstractVector, AbstractVector, AbstractVector, AbstractVector, Number, EarthLocation}"><code>RetrievalToolbox.calculate_altitude_and_gravity_levels!</code></a> ‚Äî <span class="docstring-category">Method</span></summary><section><div><pre><code class="language-julia hljs">calculate_altitude_and_gravity_levels!(
    z_levels::AbstractVector,
    g_levels::AbstractVector,
    p_levels::AbstractVector,
    T_layers::AbstractVector,
    SH_layers::AbstractVector,
    p_surf::Number,
    location::EarthLocation
)
</code></pre><p>Calculates altitude and gravity levels for Earth-type atmospheres, in-place. For now, this function over-writes <code>altitude_levels</code> and <code>gravity_levels</code> in units of <code>m</code> and <code>m/s^2</code> respectively!</p><p><strong>Details</strong></p><p>Given some atmospheric inputs (p, T, q) and the scene latitude and altitude, this function calculates the altitude and gravity profiles (on levels) corresponding to the pressure levels. These outputs should then be used to construct atmosphere objects (EarthAtmosphere).</p><p>At this point, <code>p_levels</code> must be in [Pa], <code>T_layers</code> in [K], <code>SH_layers</code> in [1], and the <code>location.altitude</code> in [m]. Alternatively, Unitful arrays with units can be used.</p></div></section></details></article><article><details class="docstring" open="true"><summary id="RetrievalToolbox.calculate_gravity_from_z!-Tuple{EarthAtmosphere}"><a class="docstring-binding" href="#RetrievalToolbox.calculate_gravity_from_z!-Tuple{EarthAtmosphere}"><code>RetrievalToolbox.calculate_gravity_from_z!</code></a> ‚Äî <span class="docstring-category">Method</span></summary><section><div><pre><code class="language-julia hljs">calculate_gravity_from_z!(atm::EarthAtmosphere; g)
</code></pre><p>Calculates local gravity based on altitude levels. The optional argument <code>g</code> can be supplied if users want a latitude=dependent surface-level gravity. Otherwise the standard gravity g0 (9.80655 ms‚Åª¬≤) is used. Note that <code>g</code> must be in compatible units of acceleration.</p><p><strong>Details</strong></p><p>The gravity <span>$g&#39;(z)$</span> at altitude <span>$z$</span> is calculated as</p><p><span>$g&#39;(z) = g \cdot (\frac{R_e}{R_e + z})^2$</span></p><p>where <span>$R_e$</span> is the (mean) Earth radius and <span>$g$</span> is the assumed gravity at the surface.</p></div></section></details></article><article><details class="docstring" open="true"><summary id="RetrievalToolbox.calculate_layers!-Tuple{EarthAtmosphere}"><a class="docstring-binding" href="#RetrievalToolbox.calculate_layers!-Tuple{EarthAtmosphere}"><code>RetrievalToolbox.calculate_layers!</code></a> ‚Äî <span class="docstring-category">Method</span></summary><section><div><pre><code class="language-julia hljs">calculate_layers!(atm::EarthAtmosphere)
</code></pre><p>In-place calculation of mid-layer values for all relevant profiles in an <code>EarthAtmosphere</code> object (p, p MET, q, T, z, g).</p></div></section></details></article><article><details class="docstring" open="true"><summary id="RetrievalToolbox.calculate_xgas-Tuple{AbstractAtmosphere}"><a class="docstring-binding" href="#RetrievalToolbox.calculate_xgas-Tuple{AbstractAtmosphere}"><code>RetrievalToolbox.calculate_xgas</code></a> ‚Äî <span class="docstring-category">Method</span></summary><section><div><pre><code class="language-julia hljs">calculate_xgas(atm::AbstractAtmosphere; gas_name) -&gt; Dict
</code></pre><p>Calculates the XGAS from an <code>AbstractAtmosphere</code> <strong>atm</strong>.</p><p>The column-averaged dry-air mole fraction is calculated according to O&#39;Dell et al., 10.5194/amt-5-99-2012. Note that the returned quantity comes with the same unit as defined in the <code>GasAbsorber</code> object, which defines the VMR levels of that particular gas.</p></div></section></details></article><article><details class="docstring" open="true"><summary id="RetrievalToolbox.create_ACOS_pressure_grid-Tuple{Union{Unitful.Quantity{T, ùêå ùêã^-1 ùêì^-2, U}, Unitful.Level{L, S, Unitful.Quantity{T, ùêå ùêã^-1 ùêì^-2, U}} where {L, S}} where {T, U}}"><a class="docstring-binding" href="#RetrievalToolbox.create_ACOS_pressure_grid-Tuple{Union{Unitful.Quantity{T, ùêå ùêã^-1 ùêì^-2, U}, Unitful.Level{L, S, Unitful.Quantity{T, ùêå ùêã^-1 ùêì^-2, U}} where {L, S}} where {T, U}}"><code>RetrievalToolbox.create_ACOS_pressure_grid</code></a> ‚Äî <span class="docstring-category">Method</span></summary><section><div><pre><code class="language-julia hljs">create_ACOS_pressure_grid(
    psurf::Union{Unitful.Quantity{T, ùêå ùêã^-1 ùêì^-2, U}, Unitful.Level{L, S, Unitful.Quantity{T, ùêå ùêã^-1 ùêì^-2, U}} where {L, S}} where {T, U}
) -&gt; Vector
</code></pre><p>Creates the ACOS-type pressure grid on 20 levels</p></div></section></details></article><article><details class="docstring" open="true"><summary id="RetrievalToolbox.create_UoL_pressure_grid-Tuple{Union{Unitful.Quantity{T, ùêå ùêã^-1 ùêì^-2, U}, Unitful.Level{L, S, Unitful.Quantity{T, ùêå ùêã^-1 ùêì^-2, U}} where {L, S}} where {T, U}, Union{Unitful.Quantity{T, ùêå ùêã^-1 ùêì^-2, U}, Unitful.Level{L, S, Unitful.Quantity{T, ùêå ùêã^-1 ùêì^-2, U}} where {L, S}} where {T, U}}"><a class="docstring-binding" href="#RetrievalToolbox.create_UoL_pressure_grid-Tuple{Union{Unitful.Quantity{T, ùêå ùêã^-1 ùêì^-2, U}, Unitful.Level{L, S, Unitful.Quantity{T, ùêå ùêã^-1 ùêì^-2, U}} where {L, S}} where {T, U}, Union{Unitful.Quantity{T, ùêå ùêã^-1 ùêì^-2, U}, Unitful.Level{L, S, Unitful.Quantity{T, ùêå ùêã^-1 ùêì^-2, U}} where {L, S}} where {T, U}}"><code>RetrievalToolbox.create_UoL_pressure_grid</code></a> ‚Äî <span class="docstring-category">Method</span></summary><section><div><pre><code class="language-julia hljs">create_UoL_pressure_grid(
    p_surf::Union{Unitful.Quantity{T, ùêå ùêã^-1 ùêì^-2, U}, Unitful.Level{L, S, Unitful.Quantity{T, ùêå ùêã^-1 ùêì^-2, U}} where {L, S}} where {T, U},
    p_tropo::Union{Unitful.Quantity{T, ùêå ùêã^-1 ùêì^-2, U}, Unitful.Level{L, S, Unitful.Quantity{T, ùêå ùêã^-1 ùêì^-2, U}} where {L, S}} where {T, U};
    N_total
) -&gt; Vector
</code></pre><p>Creates the &#39;classic&#39; University of Leicester-type pressure grid, based on the supplied surface pressure <code>p_surf</code> and the tropopause pressure <code>p_tropo</code>.</p><p><strong>Details</strong></p><p>A pressure grid is generated with fixed 5 stratospheric levels. The sixth level is halfway between tropopause pressure and level 5, and the seventh level is the tropopause pressure itself. Finally, the remaining levels are evenly spaced between the tropopause and the surface pressure. The total number of pressure levels must be greater than 8 (default: 20). If the tropopause pressure is larger than 8000 Pa (i.e. higher in the atmosphere), levels 6 and 7 are then set to predefined values and the tropopause is then considered to be level 7.</p></div></section></details></article><article><details class="docstring" open="true"><summary id="RetrievalToolbox.create_empty_EarthAtmosphere-Union{Tuple{U}, Tuple{Integer, Integer, Type{&lt;:Real}}} where U"><a class="docstring-binding" href="#RetrievalToolbox.create_empty_EarthAtmosphere-Union{Tuple{U}, Tuple{Integer, Integer, Type{&lt;:Real}}} where U"><code>RetrievalToolbox.create_empty_EarthAtmosphere</code></a> ‚Äî <span class="docstring-category">Method</span></summary><section><div><pre><code class="language-julia hljs">create_empty_EarthAtmosphere(
    Nlev::Integer,
    Nlev_met::Integer,
    T::Type{&lt;:Real};
    pressure_unit,
    met_pressure_unit,
    temperature_unit,
    specific_humidity_unit,
    altitude_unit,
    gravity_unit
) -&gt; EarthAtmosphere
</code></pre><p>Creates an empty <code>EarthAtmosphere</code> object with the specified number of retrieval grid levels, meteorological grid levels, array type <code>T</code> as well as units for the profiles. This function takes optional arguments to define the units for the various profiles.</p></div></section></details></article><article><details class="docstring" open="true"><summary id="RetrievalToolbox.create_example_atmosphere-Tuple{String, Integer}"><a class="docstring-binding" href="#RetrievalToolbox.create_example_atmosphere-Tuple{String, Integer}"><code>RetrievalToolbox.create_example_atmosphere</code></a> ‚Äî <span class="docstring-category">Method</span></summary><section><div><pre><code class="language-julia hljs">create_example_atmosphere(
    name::String,
    Nlev::Integer;
    T,
    surface_pressure,
    altitude,
    is_example
) -&gt; EarthAtmosphere{Float64}
</code></pre><p>Creates an <code>EarthAtmosphere</code> object based on some representative atmospheres that were extracted from NASA GMAO&#39;s MERRA2 reanalysis and Sourish Basu&#39;s CO2/CH4. Must provide the name of the example atmosphere <code>name</code> as well as the intended number of pressure levels for the retrieval grid, <code>Nlev</code>, to be filled out be the user later.</p><p>Optional arguments are <code>surface_pressure</code> or <code>altitude</code> (must choose one or none, never both) to adjust the model atmosphere accordingly.</p></div></section></details></article><article><details class="docstring" open="true"><summary id="RetrievalToolbox.create_example_gas_profile-Tuple{String, String, AbstractSpectroscopy, Vector{&lt;:Union{Unitful.Quantity{T, ùêå ùêã^-1 ùêì^-2, U}, Unitful.Level{L, S, Unitful.Quantity{T, ùêå ùêã^-1 ùêì^-2, U}} where {L, S}} where {T, U}}}"><a class="docstring-binding" href="#RetrievalToolbox.create_example_gas_profile-Tuple{String, String, AbstractSpectroscopy, Vector{&lt;:Union{Unitful.Quantity{T, ùêå ùêã^-1 ùêì^-2, U}, Unitful.Level{L, S, Unitful.Quantity{T, ùêå ùêã^-1 ùêì^-2, U}} where {L, S}} where {T, U}}}"><code>RetrievalToolbox.create_example_gas_profile</code></a> ‚Äî <span class="docstring-category">Method</span></summary><section><div><pre><code class="language-julia hljs">create_example_gas_profile(
    name::String,
    gas_name::String,
    spec::AbstractSpectroscopy,
    plevels::Vector{&lt;:Union{Unitful.Quantity{T, ùêå ùêã^-1 ùêì^-2, U}, Unitful.Level{L, S, Unitful.Quantity{T, ùêå ùêã^-1 ùêì^-2, U}} where {L, S}} where {T, U}};
    is_example
) -&gt; GasAbsorber
</code></pre><p>Creates a gas profile from an example atmosphere, and attaches it to a supplied spectroscopy object <code>spec</code>. Pressure levels must also be given, which have to match the retrieval pressure levels.</p></div></section></details></article><article><details class="docstring" open="true"><summary id="RetrievalToolbox.create_level_from_midlayer-Tuple{Any}"><a class="docstring-binding" href="#RetrievalToolbox.create_level_from_midlayer-Tuple{Any}"><code>RetrievalToolbox.create_level_from_midlayer</code></a> ‚Äî <span class="docstring-category">Method</span></summary><section><div><pre><code class="language-julia hljs">create_level_from_midlayer(q) -&gt; Any
</code></pre><p>Creates a level-based profile from one defined on middle-of-the-layer. Assumes that the mid-layer value is well-approximated by half the value of the layer-boundary values.</p></div></section></details></article><article><details class="docstring" open="true"><summary id="RetrievalToolbox.create_pressure_weights-Tuple{AbstractAtmosphere}"><a class="docstring-binding" href="#RetrievalToolbox.create_pressure_weights-Tuple{AbstractAtmosphere}"><code>RetrievalToolbox.create_pressure_weights</code></a> ‚Äî <span class="docstring-category">Method</span></summary><section><div><pre><code class="language-julia hljs">create_pressure_weights(
    atm::AbstractAtmosphere;
    N_sub
) -&gt; Any
</code></pre><p>Calculates the pressure weights according to O&#39;Dell et al. in 10.5194/amt-5-99-2012. Between layer boundaries, a sub-layer numerical integration is used to calculate the <span>$(1-q) / (g * M_\mathrm{dry})$</span> term, where <code>N_sub</code> determines the number of sub-layers. Note that this assumes that the gas concentrations vary linearly with pressure, as implemented in the function <code>calculate_gas_optical_depth_profiles</code>.</p></div></section></details></article><article><details class="docstring" open="true"><summary id="RetrievalToolbox.get_gas_from_name-Tuple{EarthAtmosphere, String}"><a class="docstring-binding" href="#RetrievalToolbox.get_gas_from_name-Tuple{EarthAtmosphere, String}"><code>RetrievalToolbox.get_gas_from_name</code></a> ‚Äî <span class="docstring-category">Method</span></summary><section><div><pre><code class="language-julia hljs">get_gas_from_name(
    atm::EarthAtmosphere,
    name::String
) -&gt; Union{Nothing, AbstractAtmosphereElement}
</code></pre><p>Given an atmosphere object, this function returns a reference to the gas object whose name is the same as some string <code>name</code>.</p></div></section></details></article><article><details class="docstring" open="true"><summary id="RetrievalToolbox.list_example_atmospheres-Tuple{}"><a class="docstring-binding" href="#RetrievalToolbox.list_example_atmospheres-Tuple{}"><code>RetrievalToolbox.list_example_atmospheres</code></a> ‚Äî <span class="docstring-category">Method</span></summary><section><div><pre><code class="language-julia hljs">list_example_atmospheres() -&gt; Vector{String}
</code></pre><p>Lists all available example atmospheres that can be loaded with <code>create_example_atmosphere</code>.</p></div></section></details></article><article><details class="docstring" open="true"><summary id="RetrievalToolbox.update_specific_humidity_from_H2O!-Tuple{EarthAtmosphere}"><a class="docstring-binding" href="#RetrievalToolbox.update_specific_humidity_from_H2O!-Tuple{EarthAtmosphere}"><code>RetrievalToolbox.update_specific_humidity_from_H2O!</code></a> ‚Äî <span class="docstring-category">Method</span></summary><section><div><pre><code class="language-julia hljs">update_specific_humidity_from_H2O!(
    atm::EarthAtmosphere
) -&gt; Bool
</code></pre><p>Updates the specific humidity profile of the atmosphere <code>atm</code>, if an H2O profile is available as an atmospheric element. Does <em>not</em> update gravity and altitude profiles!</p></div></section></details></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../state_vector_functions/">¬´ State Vector Functions</a><a class="docs-footer-nextpage" href="../instrument_functions/">Instrument Functions ¬ª</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.1 on <span class="colophon-date" title="Thursday 8 January 2026 17:04">Thursday 8 January 2026</span>. Using Julia version 1.12.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
